<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/lib/flexible.js"></script>
		<script type="text/javascript" src="../js/lib/flexible_css.js"></script>
		<script type="text/javascript" src="../js/lib/jquery-1.10.2.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/mycollection.css"/>
		<link rel="stylesheet" type="text/css" href="../css/sy.css"/>
		<link rel="stylesheet" type="text/css" href="../css/jxfyList.css"/>
	</head>
	<style type="text/css">
		.list_xs{display: none;}
		.list_xs .zx:last-child{display: none;}
	</style>
	<body>
		<div class="mui-content">
		    <!--下拉刷新容器开始-->
			<div id="pullrefresh" class="mui-content mui-scroll-wrapper list_xs" style="display: block;">
			    <div class="mui-scroll">
			        <!--数据列表1-->
				    <ul class="mui-table-view fy_list listUl" id="list1">
					 	
				   </ul>
			    </div>
			</div> 
			<!--下拉容器结尾-->
			<!--下拉刷新容器开始-->
			<!--<div id="pullrefresh" class="mui-content mui-scroll-wrapper list_xs">
			    <div class="mui-scroll">
				    <ul class="mui-table-view fy_list listUl" id="list2">
					 	<li class="listtail">
					 		<div class="selc">
					 			<div class="mui-input-row mui-checkbox selc_ch">
					 			    <label></label>
					 			    <input name="Checkbox" type="checkbox">
					 			</div>
					 		</div>
					 		<div class="fy_pic">
					 			<img src="../img/fypic.png" alt="" />
					 		</div>
					 		<div class="fy_xx">
					 			<p class="lp">建外SOHO</p>
					 			<p class="mjwz">朝阳区-国贸 101.5m2</p>
					 			<p class="jfList">
					 				<span class="jzjf">精装交付</span>
					 				<span class="jzdj">定金</span>
					 			</p>
					 			<p class="dj">
					 				<span>6.5<i>元/m2/天</i></span>
					 			</p>
					 		</div>
					 	</li>
					 	<li class="zx"></li>
					 	<li class="listtail">
					 		<div class="selc">
					 			<div class="mui-input-row mui-checkbox selc_ch">
					 			    <label></label>
					 			    <input name="Checkbox" type="checkbox">
					 			</div>
					 		</div>
					 		<div class="fy_pic">
					 			<img src="../img/fypic.png" alt="" />
					 		</div>
					 		<div class="fy_xx">
					 			<p class="lp">建外SOHO</p>
					 			<p class="mjwz">朝阳区-国贸 101.5m2</p>
					 			<p class="jfList">
					 				<span class="jzjf">精装交付</span>
					 				<span class="jzdj">定金</span>
					 			</p>
					 			<p class="dj">
					 				<span>4.5<i>元/m2/天</i></span>
					 			</p>
					 		</div>
					 	</li>
				    </ul>
				    
			    </div>
			</div> -->
			<!--下拉容器结尾-->
			<!--下拉刷新容器开始-->
			<!--<div id="pullrefresh" class="mui-content mui-scroll-wrapper list_xs">
			    <div class="mui-scroll">
				    <ul class="mui-table-view fy_list listUl" id="list3">
					 	<li class="listtail">
					 		<div class="selc">
					 			<div class="mui-input-row mui-checkbox selc_ch">
					 			    <label></label>
					 			    <input name="Checkbox" type="checkbox">
					 			</div>
					 		</div>
					 		<div class="fy_pic">
					 			<img src="../img/fypic.png" alt="" />
					 		</div>
					 		<div class="fy_xx">
					 			<p class="lp">建外SOHO</p>
					 			<p class="mjwz">朝阳区-国贸 101.5m2</p>
					 			<p class="jfList">
					 				<span class="jzjf">精装交付</span>
					 				<span class="jzdj">定金</span>
					 			</p>
					 			<p class="dj">
					 				<span>10.5<i>元/m2/天</i></span>
					 			</p>
					 		</div>
					 	</li>
				    </ul>
			    </div>
			</div>-->
			
		</div>
		<script src="../js/lib/app_config.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var idx = 0;
			var page = 1;//页数
			if(idx==0){
				my_shouc(idx);
			}
			window.addEventListener("tabqc", function (e) {
			    //获得事件参数
			    idx = e.detail.idx;
				//子页面tab切换功能
				for (var i=0; i<$('.list_xs').length; i++) {
					$('.list_xs').eq(i).css('display','none');
				}
				$('.list_xs').eq(idx).css('display','block');
//				mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
				my_shouc(idx);
			});
			window.addEventListener("bianji", function (e) {
			    //获得事件参数
				var bjshow = e.detail.bjshow;
				if(bjshow==1){
					$('.selc').css('display','block');
				}else{
					$('.selc').css('display','none');
					for (var j=0; j<$('#list1 input').length; j++) {
						$('#list1 input').eq(j).prop('checked',false);
					}
				}
			});
			
			
//			mui.plusReady(function() {  
//	            var self = plus.webview.currentWebview();  
//	            var txt = self.asd;
//	        })  

			mui.init({ 
				pullRefresh : { 
					container:"#pullrefresh",	
					down : {
						contentdown : "下拉可以刷新",
						contentover : "释放立即刷新",
						contentrefresh : "正在刷新...",
						callback : fndown 
					 } } 
			});
			function fndown(){
				page = 1;
				setTimeout(function(){
					$('#list1').html('');
					my_shouc(idx);			
//					mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
				},1000)
			}
			mui.init({ 
			    pullRefresh : { 
			        container:"#pullrefresh",
			        up : { 
			            contentrefresh : "正在加载...",
			            contentnomore:'没有更多数据了',
			            callback : fnup 
			        } 
			    } 
			});
			function fnup(){
				var _this = this;
				setTimeout(function(){
					my_shouc(idx);
    				_this.endPullupToRefresh(true|false); 
				},1000)
			}
			//我的收藏接口
			var sc_str = '';
			function my_shouc(dx){
				if(dx == 2){
					dx = dx + 1;//3下架
				}
//				var sc_data = [];//全部房源
//				var sc_data1 = [];//下架房源
//				var sc_data2 = [];//在租房源
				mui.ajax(url + '/yhcms/web/collecthouse/getAppCollect.do',{
					data:{
							"parameters":
							{
								"cookie":JSON.parse(localStorage.getItem('cookxs_yh')),
								"search_keywork":"",
								"curr_page":page,
								"items_perpage":10,
								"sid":dx,//0所有，1上架，3下架
							},
							"foreEndType":2,
							"code":"16"
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						if(data.success){
							page++;
							if(dx == 0){
								var sc_data = data.data;//全部							
								console.log(sc_data);
								for (var i=0; i<sc_data.length; i++) {
									if(sc_data[i].decoration_level == ''){
										if(sc_data[i].cid == 1){
											sc_str = '<li class="listtail"><div class="selc"><div class="mui-input-row mui-checkbox selc_ch"><label></label><input name="Checkbox" type="checkbox" value="'+sc_data[i].id+'" onclick="sel(this)"></div></div><div class="fy_pic"><img src="'+img_url+sc_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="lp">'+sc_data[i].topic+'&nbsp;&nbsp;'+sc_data[i].zdh+''+sc_data[i].fybh+'</p><p class="mjwz">'+sc_data[i].district+'&nbsp;'+sc_data[i].housing_area+'m²</p><p class="jfList"><span class="jzdj">定金</span></p><p class="dj"><span>'+sc_data[i].daily_price+'<i>元/m²/天</i></span></p></div></li><li class="zx"></li>';										
										}else{
											sc_str = '<li class="listtail"><div class="selc"><div class="mui-input-row mui-checkbox selc_ch"><label></label><input name="Checkbox" type="checkbox" value="'+sc_data[i].id+'" onclick="sel(this)"></div></div><div class="fy_pic"><img src="'+img_url+sc_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="lp">'+sc_data[i].topic+'&nbsp;&nbsp;'+sc_data[i].zdh+''+sc_data[i].fybh+'</p><p class="mjwz">'+sc_data[i].district+'&nbsp;'+sc_data[i].housing_area+'m²</p><p class="jfList"> </p><p class="dj"><span>'+sc_data[i].daily_price+'<i>元/m²/天</i></span></p></div></li><li class="zx"></li>';
										}
									}else{
										if(sc_data[i].cid == 1){
											sc_str = '<li class="listtail"><div class="selc"><div class="mui-input-row mui-checkbox selc_ch"><label></label><input name="Checkbox" type="checkbox" value="'+sc_data[i].id+'" onclick="sel(this)"></div></div><div class="fy_pic"><img src="'+img_url+sc_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="lp">'+sc_data[i].topic+'&nbsp;&nbsp;'+sc_data[i].zdh+''+sc_data[i].fybh+'</p><p class="mjwz">'+sc_data[i].district+'&nbsp;'+sc_data[i].housing_area+'m²</p><p class="jfList"><span class="jzjf">'+sc_data[i].decoration_level+'</span> <span class="jzdj">定金</span></p><p class="dj"><span>'+sc_data[i].daily_price+'<i>元/m²/天</i></span></p></div></li><li class="zx"></li>';										
										}else{
											sc_str = '<li class="listtail"><div class="selc"><div class="mui-input-row mui-checkbox selc_ch"><label></label><input name="Checkbox" type="checkbox" value="'+sc_data[i].id+'" onclick="sel(this)"></div></div><div class="fy_pic"><img src="'+img_url+sc_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="lp">'+sc_data[i].topic+'&nbsp;&nbsp;'+sc_data[i].zdh+''+sc_data[i].fybh+'</p><p class="mjwz">'+sc_data[i].district+'&nbsp;'+sc_data[i].housing_area+'m²</p><p class="jfList"><span class="jzjf">'+sc_data[i].decoration_level+'</span> </p><p class="dj"><span>'+sc_data[i].daily_price+'<i>元/m²/天</i></span></p></div></li><li class="zx"></li>';
										}
									}
									if(dx == 0){//全部
										$('#list1').append(sc_str);							
									}
//									else if(dx == 3){//下架
//										$('#list2').append(sc_str);
//									}else{//再租房源
//										$('#list3').append(sc_str);
//									}
								}
								mui('#pullrefresh').pullRefresh().endPulldownToRefresh((sc_data.length<1));
							}
//							else if(dx == 3){
//								var datas1 = datas1.concat(data.data);//下架房源	
//								console.log(datas1);
//							}else{
//								var datas2 = datas1.concat(data.data);//在租房源
//								console.log(datas2);
//							}
							
						}else{
							//数据获取不成功
						}
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
					}
				});
			}
			//判断登陆状态
//			denglu_zt(JSON.parse(localStorage.getItem('cookxs_yh')));
			var check_xz = true;
			var str_fyid = '';
			var arr = [];
			function sel(t){
				arr.push(t.value);
				str_fyid = arr.join(',');
				if($("#list1 input[type='checkbox']:checked").length == $('#list1 input[type="checkbox"]').length){
					check_xz = true;
				}
				if($("#list1 input[type='checkbox']:checked").length != $('#list1 input[type="checkbox"]').length){
					check_xz = false;
				}
				console.log(check_xz)
				var main = plus.webview.getWebviewById('person1');
				mui.fire(main, "all_dsel",{
				    dsel: check_xz
				})
			}
			//全选
			window.addEventListener("all_cek", function (e) {
			    //获得事件参数
				var cek = e.detail.cek;
				if(cek==2){
					sel_list1();
				}
				if(cek==3){
					qxsel_list1();
				}
			});
			function sel_list1(){//全选1
				for (var i=0; i<$('#list1 input').length; i++) {
					$('#list1 input').eq(i).prop('checked',true);
				}
				str_fyid = $("#list1 input:checked").map(function(index,elem) {
		            return $(elem).val();
		        }).get().join(',');
			}
			function qxsel_list1(){//取消全选1
				for (var j=0; j<$('#list1 input').length; j++) {
					$('#list1 input').eq(j).prop('checked',false);
				}
				str_fyid = '';
			}
			//删除收藏/yskjApp/appYskj/V1/delCollect.do
			function del_sc(){
//				alert(str_fyid);
				mui.ajax(url + '/yskjApp/appYskj/V1/delCollect.do',{
					data:{
						"ids":str_fyid
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						if(data.success){
							mui.toast(data.message,{ duration:'2000', type:'div' });
							var wobj = plus.webview.getWebviewById("mysc_list");
							wobj.reload(true);
						}else{
							
						}
					},
					error:function(xhr,type,errorThrown){
						console.log(type);
					}
				});
			}
			
			window.addEventListener("del_selsc", function (e) {
			    //获得事件参数
				var selsc = e.detail.selsc;
				del_sc();
			});
		</script>
		
	</body>

</html>